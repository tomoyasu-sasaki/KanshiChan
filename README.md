## Kanchichan

スケジュール管理とWebカメラ映像のリアルタイム物体検知（YOLOv11/ONNXRuntime）を組み合わせたデスクトップアプリ（Electron）。

### 主な機能
- **リアルタイム監視**: Webカメラからの映像に対して人物・スマホを検知し、画面全体に表示
- **自動監視開始**: アプリ起動時に自動的にカメラを起動して監視開始
- **スマホ検知アラート**: スマホが一定時間検知されるとアラート通知（音/デスクトップ通知）
- **不在検知アラート**: 人物が一定時間検知されないとアラート通知
- **スケジュール管理**: ローカル保存・時刻通知（5分前/時刻）
- **監視画面**: フルスクリーン監視画面、下部ツールバー、右側ドロワー型の設定/スケジュール/ログ

### 依存関係
- Node.js / npm
- Electron ^38
- onnxruntime-node ^1.23.0
- canvas ^3.2.0
- @tensorflow/tfjs-node ^4.22.0（将来拡張用。現状はONNX Runtimeで検知）

### プロジェクト構成

```
kanchichan/
├─ main.js                      # Electron メインプロセス（ウィンドウ生成/IPC/通知/YOLO呼び出し）
├─ package.json                 # スクリプト・依存関係
├─ models/
│  ├─ yolo11n.onnx             # YOLOv11 ONNX モデル
│  └─ yolo11n.pt               # 参考モデル（未使用）
└─ src/
   ├─ preload.js               # contextBridge でレンダラへAPI公開
   ├─ pages/
   │  └─ index.html            # 監視UI（単一ページアプリ）
   ├─ renderer/
   │  ├─ app.js                # UI統合管理（ツールバー・ドロワー・時計・自動開始等）
   │  ├─ monitor.js            # 検知ループ/状態管理/描画/アラート処理
   │  ├─ schedule.js           # スケジュールCRUD・時刻通知
   │  └─ settings.js           # 設定の読込/保存、UI反映
   ├─ styles/
   │  └─ style.css             # スタイル（全画面カメラ・ツールバー・ドロワー）
   └─ utils/
      └─ yolo-detector.js      # YOLOv11（ONNXRuntime）による物体検知
```

### 動作要件
- macOS 14+ など（Electron対応OS）
- ネイティブモジュールのビルドに Xcode 等のビルドツールが必要な場合があります（canvas/onnxruntime-node）

### セットアップ & 起動

```bash
npm install
npm start
```

初回起動時にカメラ使用許可のダイアログが表示されます。許可後、約0.5秒で自動的に監視が開始されます。

### 使い方

#### 監視画面
- アプリ起動と同時にカメラが起動し、全画面で監視映像を表示
- 右上のバッジに「📱スマホ検知時間」「👤不在時間」をリアルタイム表示
- 左上に「監視中」インジケーター（赤い点滅ドット）

#### ツールバー（画面下部）
- **⏸️ 停止/▶️ 開始**: 監視の開始・停止をトグル
- **📅 スケジュール**: 右側からドロワーが開き、スケジュール追加/一覧/削除
- **⚙️ 設定**: 検知の閾値・感度・通知設定を変更
- **📋 ログ**: 検知ログをタイムスタンプ付きで表示
- **❌ 終了**: アプリを終了

#### スケジュール機能
- ドロワーからタイトル・日時・説明を入力して追加
- 5分前と開始時刻にデスクトップ通知
- localStorage に保存

#### 設定機能
- **スマホ検知**: アラート閾値（秒）、検知感度、アラート有効/無効
- **不在検知**: アラート閾値（秒）、検知感度、アラート有効/無効
- **通知**: アラート音、デスクトップ通知の有効/無効

### 技術的な特徴

#### アーキテクチャ
- **単一ページアプリ**: ページ遷移なしのシンプルな構成
- **状態管理**: `monitor.js` 内でローカル変数として管理（グローバル汚染を回避）
- **非同期検知**: 0.2秒ごとにYOLOv11で物体検知、60FPSで描画ループ実行

#### 物体検知
- メインプロセスで ONNX Runtime を使用して YOLOv11 モデルを実行
- `preload.js` 経由で `window.electronAPI.detectObjects()` を提供
- 検知対象: `person` (人物) と `cell phone` (スマホ) のみ
- フレーム補完: 2秒間の時間窓で検知結果を平滑化し、誤検知を軽減

#### UI/UX
- **デザイン**: 暗い背景、オーバーレイ表示、ツールバー、ドロワー
- **レスポンシブ**: `object-fit: cover` でカメラ映像を画面いっぱいに表示
- **滑らかな描画**: 検出結果を1秒間保持して、バウンディングボックスが断続的に消えないように最適化

### ライセンス
ISC


