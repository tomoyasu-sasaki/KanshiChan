# 開発規約（Kanshichan）

Kanshichan の実装を可読・保守・拡張しやすい状態で維持するための開発規約です。プルリクエスト／コミット時には本ガイドラインを参照し、整合性を保ってください。

## 1. アーキテクチャ方針
- **責務分離**
  - メインプロセス (`main.js` / `src/main/**`) は Electron 固有処理・IPC 登録・ネイティブ API 連携に限定する。
  - レンダラ (`src/renderer/**`) は DOM 操作・状態管理・UI ロジックを担当し、ネイティブアクセスは必ず `preload.js` 経由の `window.electronAPI` を介す。
  - 共通定数や設定値は `src/constants/**` で一元管理し、ハードコードを避ける。
- **サービス層の再利用**
  - AppleScript・VOICEVOX などの外部 I/O は `src/main/services/**` にまとめ、IPC ハンドラから呼び出す。
  - 同等の処理を複数箇所で利用する場合は、共通化して単体テストしやすい形に整理する。
- **スタイルガイド**
  - CSS は `src/styles` に機能単位で分割し、`style.css` から `@import` する。
  - 新規スタイル追加時はどのページ／ドロワー向けか明確にファイルを選択する。

## 2. コーディング規約
- **言語 / フォーマット**
  - JavaScript は ES modules を優先（レンダラ）。メインプロセスは CommonJS を維持。
  - インデント 2 スペース、トレーリングスペースなし。
  - 文字列はシングルクォート（テンプレート文字列を除く）。
- **関数・変数命名**
  - キャメルケースを使用。真偽値は `isXxx`, `hasXxx` などのプレフィックス。
  - IPC チャンネル名は `snake_case`、処理内容を端的に示す（例: `detect-objects`, `tts-speak`）。
- **コメント**
  - `docs/comment-guidelines.md` を参照。ファイル先頭には責務概要を明記。
  - 仕様背景・制約・トレードオフなど “Why” を中心に記述し、コードから明らかな内容は書かない。

## 3. ディレクトリ / ファイル運用
- `src/constants/` には再利用される設定・閾値・メッセージをまとめる。新規定数追加時は重複を確認し、既存ファイルに追記するか判断する。
- メインプロセス補助モジュールは `src/main/` 配下に配置し、分類（`services/`, `ipc/` など）を保つ。
- スタイルは `base`, `drawer`, `monitor`, `schedule`, `settings` に大別。新しいページや機能追加時は必要に応じてファイルを増やし、`style.css` へ追記。

## 4. 依存関係の扱い
- ONNX Runtime / canvas / VOICEVOX などのネイティブ依存は README に明記済み。バージョンアップ時は互換性とビルド手順を確認する。
- 新しい npm パッケージを追加する場合は、Electron 環境での動作可否とライセンスを確認し、README へ追記する。

## 5. テスト / 動作確認
- `npm start` で監視画面が起動することを基本的な動作確認とする。
- 物体検知が非同期のため、エラー時はレンダラコンソールとメインプロセスログを両方確認する。
- VOICEVOX 読み上げを利用する機能を変更した場合は、エンジン起動時／非起動時の挙動を手動テストする。

## 6. Git 運用
- ブランチ命名例: `feature/<概要>`, `fix/<概要>`。
- コミットは意味のある単位でまとめ、メッセージは日本語または英語で簡潔に。例: `fix: スマホ検知閾値の保存不備を修正`。
- PR 作成時は README と docs が更新済みか点検する。規約に反するコメント・ハードコードが追加されていないか確認する。

## 7. セキュリティ / プライバシー
- カメラ映像やログに個人情報を含めない。解析や保存が必要な場合は別途暗号化・アクセス制御を検討する。
- VOICEVOX 接続先など、秘匿情報は `.env` などの設定ファイルで管理し、リポジトリに含めない（将来導入予定）。

## 8. 拡張指針
- 新規検知クラスを追加する場合は `src/constants/yolo-classes.js` と監視設定の `DEFAULT_MONITOR_SETTINGS` を更新し、UI から選択可能にする。
- メインプロセスに負荷が集中する場合は、ワーカー化や WebGPU / TensorFlow.js へのオフロードを検討する。
- 複数カメラ対応など大規模拡張を行う際は、状態管理を分割し Redux 等を導入するか検討する。

## 9. ドキュメント
- コード規約・コメント規約・開発規約は `docs/` に配置する。更新時はバージョン履歴を Git 履歴で追跡する。
- README は常に最新の機能構成と依存関係に合うようメンテナンスする。

---
本規約に違反する変更はレビュー時に差し戻される可能性があります。プロジェクトの可読性・保守性・拡張性を保つため、常に規約を意識した開発を心掛けてください。
