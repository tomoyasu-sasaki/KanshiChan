# 不在許可（Absence Override）機能 ガイド

## 概要
昼休憩・買い出しなど監視範囲外の行動時に、不在検知を一時的に PASS するための機能です。不在許可を開始すると、許可中の不在はアラートや統計から除外され、監視ダッシュボードやレポートには「許可済み不在」として表示されます。

## 使い方
1. 監視画面右上の「⚙️ 設定」を開きます。
2. 設定ドロワー上部にある「🚶‍♂️ 一時的な不在許可」セクションから、以下のいずれかを選択します。
   - プリセットボタン（例: `昼休憩 (60分)`、`トイレ (15分)` など）
   - カスタム理由と滞在時間を入力し、`許可を開始` をクリック
3. 許可中はモニター画面右上に緑の `PASS` バッジが表示され、残り時間がカウントダウンされます。
4. 早めに戻った場合は `許可を終了` を押してください。時間経過で自動終了した場合は履歴に「自動終了」として記録されます。

## ダッシュボードへの反映
- KPI カードに「許可済み不在」「未許可の不在」が表示され、差分を把握できます。
- ログテーブルでは、許可開始/終了/延長の操作内容と理由が確認できます。
- CSV エクスポートにも理由と終了予定時刻が含まれます。

## 手動検証チェックリスト
1. 設定ドロワーから `散歩 (20分)` を開始し、モニターバッジが表示されることを確認。
2. 開始中に不在検知が走らない（アラート音・Slack なし）ことを確認。
3. 許可を手動終了し、履歴に「手動終了」で記録されることを確認。
4. ダッシュボード KPI に `許可済み不在` が表示され、ログに操作履歴が残ることを確認。
5. CSV エクスポートに許可操作が出力されることを確認。

## 補足
- 許可中に新しいプリセットを押すと、直前の許可を終了し再度開始します。
- 履歴は最新10件を表示します。より古い履歴は SQLite の `absence_override_events` テーブルに保存されています。
