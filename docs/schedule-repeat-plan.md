# スケジュール繰り返し対応 実装計画

## 1. データモデルと基盤整備
- [x] 既存スケジュールのローカルストレージスキーマ調査 ✅
- [x] `schedule` オブジェクトに `repeat` フィールド（`null` or `{ type: 'weekly', days: number[] }`）を追加 ✅
- [x] 通知処理（事前/開始通知）で繰り返し予定を解釈するユーティリティ実装 ✅
- [x] 既存保存データの後方互換を検証（`repeat` 無しの場合の挙動確認） ✅

## 2. 手動個別追加 UI 拡張
- [x] スケジュールドロワーに「繰り返し設定」UI（曜日トグル + プリセット）を追加 ✅
- [x] `schedule.js` の入力収集ロジックに `repeat` データを組み込み ✅
- [x] スケジュール一覧表示で繰り返し情報を表記（例: "毎週 月・水・金"） ✅
- [x] 編集時に既存の繰り返し設定をUIに反映 ✅

## 3. 手動一括追加対応
- [x] 現行の一括追加フォーマット（CSV/テキスト）を確認 ✅
- [x] `repeatDays` 列/記法を追加し、`repeat` オブジェクトに変換する処理を実装 ✅
- [x] 取込プレビューに繰り返し情報を表示し、編集可能にする ✅
- [x] エラーハンドリングと不正値のフォールバック（単発に落とす等）を追加 ✅

## 4. 音声入力フロー拡張
- [x] LLM 抽出プロンプトに繰り返し表現の抽出ルールを追加 ✅
- [x] LLM 出力スキーマ更新（`repeat` フィールドを含む）とパース実装 ✅
- [x] 音声抽出結果カードに曜日トグルの編集 UI を追加 ✅
- [x] 保存前の TTS 再生成ロジックで繰り返し情報を活用（必要に応じて TTS 文に反映） ✅

## 5. 通知・派生機能の更新
- [x] TTS メッセージテンプレートを繰り返し予定に対応（例: 「今日も9時45分から…」） ✅
- [x] Slack レポート・ダッシュボードで繰り返し情報を追加表示 ✅
- [x] CSV エクスポート/インポートに `repeat` 情報を含める ✅
- [ ] 追加のQA: 平日だけ/隔週等のエッジケース処理（必要であれば追加仕様を検討）※テスト手順は `docs/testing-checklist.md` を参照

## 参考メモ
- 曜日表現は 0(日)〜6(土) の数値配列で統一する（Macアラームと同様のUI表現）。
- 長期的には `repeat` を拡張し、隔週や毎月にも対応できるよう拡張性を意識する。
