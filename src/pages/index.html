<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kanshichan - 監視</title>
  <link rel="stylesheet" href="../styles/style.css">
</head>
<body class="monitor-view">
  <!-- メイン監視画面 -->
  <div class="monitor-container">
    <!-- カメラフィード -->
    <div class="camera-feed">
      <video id="videoElement" autoplay playsinline></video>
      <canvas id="canvasElement"></canvas>
      
      <!-- ステータス表示（オーバーレイ） -->
      <div class="status-overlay">
        <div class="status-badge" id="phoneStatusBadge">
          <span class="icon">📱</span>
          <span id="phoneTimer">0:00</span>
        </div>
        <div class="status-badge" id="presenceStatusBadge">
          <span class="icon">👤</span>
          <span id="absenceTimer">0:00</span>
        </div>
        <div class="status-badge override" id="overrideStatusBadge" hidden>
          <span class="icon">🚶‍♂️</span>
          <span id="overrideStatusText">PASS</span>
        </div>
      </div>

      <!-- 監視状態インジケーター -->
      <div class="monitor-indicator" id="monitorIndicator">
        <div class="recording-dot"></div>
        <span>監視中</span>
      </div>
    </div>

    <!-- のツールバー -->
    <div class="toolbar">
      <div class="toolbar-left">
        <div class="app-info">
          <h1>📹 Kanshichan</h1>
          <span class="time-display" id="currentTime">--:--</span>
        </div>
      </div>

      <div class="toolbar-center">
        <button class="tool-button" id="tasksBtn" title="タスク">
          <span class="icon">📝</span>
          <span class="label">タスク</span>
        </button>
        <button class="tool-button" id="scheduleBtn" title="スケジュール">
          <span class="icon">📅</span>
          <span class="label">スケジュール</span>
        </button>
        <button class="tool-button" id="settingsBtn" title="設定">
          <span class="icon">⚙️</span>
          <span class="label">設定</span>
        </button>
        <button class="tool-button" id="logsBtn" title="ログ">
          <span class="icon">📋</span>
          <span class="label">ログ</span>
        </button>
        <button class="tool-button" id="chatBtn" title="音声チャット">
          <span class="icon">💬</span>
          <span class="label">チャット</span>
        </button>
        <button class="tool-button" id="dashboardBtn" title="検知ダッシュボード">
          <span class="icon">📊</span>
          <span class="label">ダッシュボード</span>
        </button>
      </div>

      <div class="toolbar-right">
        <button class="tool-button danger" id="exitBtn" title="終了">
          <span class="icon">❌</span>
        </button>
      </div>
    </div>
  </div>

  <!-- スケジュールダイアログ -->
  <div class="dialog" id="scheduleDialog">
    <div class="dialog-content">
      <div class="dialog-header">
        <h2>📅 スケジュール管理</h2>
        <button class="close-btn" data-dialog="scheduleDialog">×</button>
      </div>

      <div class="dialog-body">
        <div class="schedule-form-container">
          <h3>スケジュール追加</h3>

          <section class="schedule-voice-section">
            <h4>音声で追加</h4>
            <p class="schedule-voice-helper">録音後に表示される候補をフォームへ取り込み、必要に応じて編集してください。</p>
            <div id="scheduleVoiceControl"></div>
            <div id="scheduleVoiceResults" class="schedule-voice-results"></div>
          </section>

          <!-- タブ切り替え -->
          <div class="schedule-input-tabs">
            <button class="tab-button active" data-tab="single">1件ずつ</button>
            <button class="tab-button" data-tab="bulk">一括入力</button>
          </div>

          <!-- 1件ずつフォーム -->
          <form id="scheduleForm" class="tab-content active" data-tab-content="single">
            <div class="form-group">
              <label for="title">タイトル</label>
              <input type="text" id="title" required>
            </div>

            <div class="form-group">
              <label for="date">日付</label>
              <input type="date" id="date" required>
            </div>

            <div class="form-group">
              <label for="time">時刻</label>
              <input type="time" id="time" required>
            </div>

            <div class="form-group">
              <label for="description">説明</label>
              <textarea id="description" rows="3"></textarea>
            </div>

            <div class="form-group repeat-settings">
              <label>繰り返し設定</label>
              <div class="repeat-presets">
                <button type="button" class="repeat-preset" data-repeat="none">繰り返しなし</button>
                <button type="button" class="repeat-preset" data-repeat="weekdays">平日</button>
                <button type="button" class="repeat-preset" data-repeat="everyday">毎日</button>
              </div>
              <div class="repeat-weekdays" id="repeatWeekdayContainer">
                <label class="repeat-day">
                  <input type="checkbox" class="repeat-day-checkbox" value="1">
                  月
                </label>
                <label class="repeat-day">
                  <input type="checkbox" class="repeat-day-checkbox" value="2">
                  火
                </label>
                <label class="repeat-day">
                  <input type="checkbox" class="repeat-day-checkbox" value="3">
                  水
                </label>
                <label class="repeat-day">
                  <input type="checkbox" class="repeat-day-checkbox" value="4">
                  木
                </label>
                <label class="repeat-day">
                  <input type="checkbox" class="repeat-day-checkbox" value="5">
                  金
                </label>
                <label class="repeat-day">
                  <input type="checkbox" class="repeat-day-checkbox" value="6">
                  土
                </label>
                <label class="repeat-day">
                  <input type="checkbox" class="repeat-day-checkbox" value="0">
                  日
                </label>
              </div>
              <div class="repeat-summary" id="repeatSummary">繰り返しなし</div>
            </div>

            <div class="schedule-form-actions">
              <button type="submit" class="btn-primary" id="scheduleSubmitBtn">追加</button>
              <button type="button" class="btn-secondary" id="scheduleCancelEditBtn" hidden>キャンセル</button>
            </div>
            <p class="schedule-edit-hint" id="scheduleEditHint" hidden>編集中: 内容を更新したら「更新」を押すか、キャンセルで編集を終了します。</p>
          </form>

          <!-- 一括入力フォーム -->
          <div class="tab-content" data-tab-content="bulk">
            <div class="form-group">
              <label for="bulkInput">
                一括入力（1行に1件: 時刻 タイトル | 繰り返し）
                <span class="input-hint">例: 10:00 朝会 | mon,wed</span>
              </label>
              <textarea id="bulkInput" rows="8" placeholder="10:00 朝会 | mon,wed&#10;11:30 ランチ&#10;13:00 レビュー会議 | weekday&#10;15:00 コーディング時間"></textarea>
            </div>
            <button type="button" id="bulkAddBtn" class="btn-primary">一括追加</button>
      </div>
    </div>

    <div class="schedule-tools">
      <div class="schedule-tools-header">
        <h4>CSV インポート / エクスポート</h4>
        <p>列: title, date, time, description, repeat_type, repeat_days</p>
      </div>
      <div class="schedule-tools-actions">
        <button type="button" class="btn-secondary" id="scheduleCsvImportBtn">CSVインポート</button>
        <button type="button" class="btn-secondary" id="scheduleCsvExportBtn">CSVエクスポート</button>
      </div>
      <input type="file" id="scheduleCsvInput" accept=".csv" hidden>
    </div>

    <div class="schedule-list-container">
      <h3>スケジュール一覧</h3>
      <div id="scheduleItems" class="schedule-items">
        <p class="empty-message">スケジュールはありません</p>
      </div>
        </div>
      </div>
    </div>
  </div>

  <!-- タスクダイアログ -->
  <div class="dialog" id="tasksDialog">
    <div class="dialog-content">
      <div class="dialog-header">
        <h2>✅ タスク管理</h2>
        <button class="close-btn" data-dialog="tasksDialog">×</button>
      </div>

      <div class="dialog-body">
        <section class="tasks-voice-section">
          <h4>音声で操作</h4>
          <p class="tasks-voice-helper">「新しいタスクを追加」「明日から来週までに変更」「優先度を高に」など</p>
          <div id="tasksVoiceControl"></div>
          <div id="tasksVoiceMessage" class="tasks-voice-message"></div>
        </section>

        <form id="taskForm" class="tasks-form">
          <input type="hidden" id="taskId">
          <div class="form-group">
            <label for="taskTitle">タイトル</label>
            <input type="text" id="taskTitle" placeholder="例: 週報を作成" required>
          </div>
          <div class="form-group">
            <label for="taskDescription">説明</label>
            <textarea id="taskDescription" rows="3" placeholder="補足 (任意)"></textarea>
          </div>
          <div class="tasks-form-row">
            <div class="filter-group">
              <label for="taskPriority">優先度</label>
              <select id="taskPriority">
                <option value="low">低</option>
                <option value="medium" selected>中</option>
                <option value="high">高</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="taskStatus">ステータス</label>
              <select id="taskStatus">
                <option value="todo" selected>未着手</option>
                <option value="in_progress">進行中</option>
                <option value="done">完了</option>
              </select>
            </div>
          </div>
          <div class="tasks-form-row">
            <div class="filter-group">
              <label for="taskStartDate">開始日</label>
              <input type="date" id="taskStartDate">
            </div>
            <div class="filter-group">
              <label for="taskEndDate">終了日</label>
              <input type="date" id="taskEndDate">
            </div>
          </div>
          <div class="filter-group">
            <label for="taskScheduleId">スケジュールに紐付け (任意)</label>
            <select id="taskScheduleId">
              <option value="">未指定</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="taskParentId">親タスク (任意)</label>
            <select id="taskParentId">
              <option value="">未指定</option>
            </select>
          </div>
          <div class="form-group">
            <label for="taskTagsInput">タグ (カンマ区切り)</label>
            <input type="text" id="taskTagsInput" placeholder="例: 緊急, 共有事項">
          </div>
          <div class="tasks-repeat-section">
            <label for="taskRepeatType">繰り返し設定</label>
            <div class="tasks-repeat-controls">
              <select id="taskRepeatType">
                <option value="none" selected>繰り返しなし</option>
                <option value="daily">毎日</option>
                <option value="weekly">毎週</option>
                <option value="monthly">毎月</option>
              </select>
              <label class="repeat-interval">
                <span>間隔</span>
                <input type="number" id="taskRepeatInterval" min="1" value="1">
              </label>
            </div>
            <div class="tasks-repeat-weekdays" id="taskRepeatWeekdays">
              <label><input type="checkbox" value="1">月</label>
              <label><input type="checkbox" value="2">火</label>
              <label><input type="checkbox" value="3">水</label>
              <label><input type="checkbox" value="4">木</label>
              <label><input type="checkbox" value="5">金</label>
              <label><input type="checkbox" value="6">土</label>
              <label><input type="checkbox" value="0">日</label>
            </div>
          </div>
          <div class="tasks-form-actions">
            <button type="submit" class="btn-primary" id="taskSubmitBtn">追加</button>
            <button type="button" class="btn-secondary" id="taskCancelEditBtn" hidden>キャンセル</button>
          </div>
        </form>

        <div class="tasks-list-container">
          <h3>タスク一覧</h3>
          <div class="tasks-filters">
            <label>
              <input type="checkbox" id="tasksShowOnlyActive">
              期間中のみ
            </label>
            <label>
              <input type="checkbox" id="tasksHideDone">
              完了を隠す
            </label>
            <div class="tasks-tag-filters" id="tasksTagFilters"></div>
          </div>
          <div class="tasks-advanced-filters" id="tasksAdvancedFilters">
            <button type="button" class="btn-secondary btn-compact" id="tasksAdvancedFiltersToggle">
              <span>高度なフィルタ</span>
              <span class="filter-icon">▼</span>
            </button>
            <div class="tasks-advanced-filters-panel" id="tasksAdvancedFiltersPanel" hidden>
              <div class="filter-group">
                <label for="tasksFilterStatus">ステータス</label>
                <select id="tasksFilterStatus" multiple>
                  <option value="todo">未着手</option>
                  <option value="in_progress">進行中</option>
                  <option value="done">完了</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="tasksFilterPriority">優先度</label>
                <select id="tasksFilterPriority" multiple>
                  <option value="low">低</option>
                  <option value="medium">中</option>
                  <option value="high">高</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="tasksFilterDateRange">日付範囲</label>
                <select id="tasksFilterDateRange">
                  <option value="">指定なし</option>
                  <option value="today">今日</option>
                  <option value="tomorrow">明日</option>
                  <option value="this_week">今週</option>
                  <option value="next_week">来週</option>
                  <option value="this_month">今月</option>
                  <option value="next_month">来月</option>
                  <option value="this_quarter">今四半期</option>
                  <option value="overdue">期限切れ</option>
                  <option value="custom">カスタム</option>
                </select>
              </div>
              <div class="filter-group" id="tasksFilterCustomDates" hidden>
                <label>開始日</label>
                <input type="date" id="tasksFilterStartDate">
                <label>終了日</label>
                <input type="date" id="tasksFilterEndDate">
              </div>
              <div class="filter-group">
                <label for="tasksFilterConditionMode">条件の組み合わせ</label>
                <select id="tasksFilterConditionMode">
                  <option value="AND">すべて満たす (AND)</option>
                  <option value="OR">いずれか満たす (OR)</option>
                </select>
              </div>
              <div class="filter-group">
                <button type="button" class="btn-secondary btn-compact" id="tasksSaveFilter">
                  フィルタを保存
                </button>
                <button type="button" class="btn-secondary btn-compact" id="tasksLoadFilter">
                  保存済みフィルタを読み込み
                </button>
                <button type="button" class="btn-secondary btn-compact" id="tasksClearFilter">
                  フィルタをクリア
                </button>
              </div>
              <select id="tasksSavedFilters" style="display: none;">
                <option value="">保存済みフィルタを選択...</option>
              </select>
            </div>
          </div>
          <div class="tasks-sort-controls" id="tasksSortControls">
            <div class="tasks-sort-group">
              <label for="tasksSortBy1">ソート1</label>
              <select id="tasksSortBy1">
                <option value="displayOrder">表示順</option>
                <option value="updatedAt">更新日時</option>
                <option value="createdAt">作成日時</option>
                <option value="title">タイトル</option>
                <option value="priority">優先度</option>
                <option value="status">ステータス</option>
                <option value="startDate">開始日</option>
                <option value="endDate">終了日</option>
              </select>
              <select id="tasksSortOrder1">
                <option value="asc">昇順</option>
                <option value="desc" selected>降順</option>
              </select>
            </div>
            <div class="tasks-sort-group">
              <label for="tasksSortBy2">ソート2</label>
              <select id="tasksSortBy2">
                <option value="">指定なし</option>
                <option value="displayOrder">表示順</option>
                <option value="updatedAt" selected>更新日時</option>
                <option value="createdAt">作成日時</option>
                <option value="title">タイトル</option>
                <option value="priority">優先度</option>
                <option value="status">ステータス</option>
                <option value="startDate">開始日</option>
                <option value="endDate">終了日</option>
              </select>
              <select id="tasksSortOrder2">
                <option value="asc">昇順</option>
                <option value="desc" selected>降順</option>
              </select>
            </div>
            <div class="tasks-sort-group">
              <label for="tasksGroupBy">グループ化</label>
              <select id="tasksGroupBy">
                <option value="">なし</option>
                <option value="priority">優先度別</option>
                <option value="status">ステータス別</option>
                <option value="parentTaskId">親タスク別</option>
              </select>
            </div>
            <div class="tasks-sort-group">
              <button type="button" class="btn-secondary btn-compact" id="tasksSaveSort">ソートを保存</button>
              <button type="button" class="btn-secondary btn-compact" id="tasksResetSort">リセット</button>
            </div>
          </div>
          <div class="tasks-view-controls">
            <label class="tasks-view-toggle">
              <input type="radio" name="tasksView" value="list" checked>
              <span>リスト</span>
            </label>
            <label class="tasks-view-toggle">
              <input type="radio" name="tasksView" value="card">
              <span>カード</span>
            </label>
            <label class="tasks-view-toggle">
              <input type="radio" name="tasksView" value="kanban">
              <span>カンバン</span>
            </label>
          </div>
          <div id="tasksItems" class="tasks-items tasks-view-list">
            <p class="empty-message">タスクはありません</p>
          </div>
        </div>

        <div class="tasks-tools">
          <div class="tasks-reading-settings" id="tasksReadingSettings"></div>
          <span id="tasksAnnounceHint" class="help-text">毎朝9時に期間中のタスクを読み上げます（日付未設定は除外）</span>
        </div>
      </div>
    </div>
  </div>

  <!-- 設定ドロワー -->
  <div class="drawer" id="settingsDrawer">
    <div class="drawer-content">
      <div class="drawer-header">
        <h2>⚙️ 設定</h2>
        <button class="close-btn" data-drawer="settingsDrawer">×</button>
      </div>
      
      <div class="drawer-body">
        <section class="settings-voice-section">
          <h3>🎙️ 音声コマンド</h3>
          <p class="settings-voice-helper">音声で設定を変更できます。「通知をオフにして」「スマホアラートを70秒に」などと話しかけてください。</p>
          <div id="settingsVoiceControl"></div>
          <div id="settingsVoiceResult" class="settings-voice-result"></div>
          <div class="voice-dictionary-panel">
            <h4>🗂️ カスタムフレーズ辞書</h4>
            <p class="voice-dictionary-helper">よく使う言い回しを登録すると、音声コマンドの認識が向上します。</p>
            <div class="voice-dictionary-form">
              <label for="voiceDictionaryPhrase">音声フレーズ</label>
              <input type="text" id="voiceDictionaryPhrase" placeholder="例: 画面オフモード" maxlength="40">
              <label for="voiceDictionaryTarget">割り当てる設定</label>
              <select id="voiceDictionaryTarget"></select>
              <div class="voice-dictionary-actions">
                <button type="button" id="voiceDictionaryAddBtn" class="btn-secondary">カスタムフレーズを追加</button>
                <button type="button" id="voiceDictionaryExportBtn" class="btn-tertiary">エクスポート</button>
                <button type="button" id="voiceDictionaryImportBtn" class="btn-tertiary">インポート</button>
              </div>
              <div id="voiceDictionaryMessage" class="voice-dictionary-message"></div>
            </div>
            <div class="voice-dictionary-unresolved">
              <h5>最近の未解決フレーズ</h5>
              <div id="voiceDictionaryUnresolved" class="voice-dictionary-unresolved-list"></div>
            </div>
            <ul id="voiceDictionaryList" class="voice-dictionary-list"></ul>
          </div>
        </section>

        <!-- アコーディオンメニュー -->
        <div class="accordion">
          <!-- 一時的な不在許可 -->
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span>🚶‍♂️ 一時的な不在許可</span>
              <span class="accordion-icon">▼</span>
            </button>
            <div class="accordion-content">
              <div class="form-group">
                <p class="description">
                  昼休憩や買い出しなど監視範囲外に出るタイミングで不在検知を一時的に PASS できます。
                  許可中は不在アラートや集計がカウントされません。
                </p>
                <div class="absence-override-status" id="absenceOverrideStatus">
                  <div class="status-line">
                    <span class="status-label">現在の状態</span>
                    <span class="status-value" id="absenceOverrideStatusText">未許可</span>
                  </div>
                  <div class="status-line" id="absenceOverrideCountdownRow" hidden>
                    <span class="status-label">残り時間</span>
                    <span class="status-countdown" id="absenceOverrideCountdown">--</span>
                  </div>
                </div>

                <div class="absence-override-actions">
                  <div class="preset-group">
                    <button type="button" class="btn-secondary override-preset" data-minutes="60" data-reason="昼休憩" data-preset-id="lunch">昼休憩 (60分)</button>
                    <button type="button" class="btn-secondary override-preset" data-minutes="15" data-reason="トイレ休憩" data-preset-id="restroom">トイレ (15分)</button>
                    <button type="button" class="btn-secondary override-preset" data-minutes="30" data-reason="買い出し" data-preset-id="shopping">買い出し (30分)</button>
                    <button type="button" class="btn-secondary override-preset" data-minutes="20" data-reason="散歩" data-preset-id="walk">散歩 (20分)</button>
                    <button type="button" class="btn-secondary override-preset" data-minutes="45" data-reason="お風呂" data-preset-id="bath">お風呂 (45分)</button>
                  </div>

                  <div class="custom-group">
                    <div class="form-row">
                      <label for="absenceOverrideReason">理由</label>
                      <input type="text" id="absenceOverrideReason" placeholder="例: スーパー" maxlength="40">
                    </div>
                    <div class="form-row">
                      <label for="absenceOverrideMinutes">滞在時間 (分)</label>
                      <div class="custom-duration">
                        <input type="number" id="absenceOverrideMinutes" min="5" max="240" step="5" value="30">
                        <button type="button" id="absenceOverrideStartBtn" class="btn-primary">許可を開始</button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="absence-override-footer">
                  <button type="button" id="absenceOverrideClearBtn" class="btn-secondary">許可を終了</button>
                  <span class="help-text" id="absenceOverrideMessage"></span>
                </div>

                <details class="absence-override-history" id="absenceOverrideHistoryPanel">
                  <summary>最近の許可履歴</summary>
                  <ul class="absence-override-history-list" id="absenceOverrideHistoryList">
                    <li class="empty">履歴がありません</li>
                  </ul>
                </details>
              </div>
            </div>
          </div>

          <!-- 検知モデル設定 -->
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span>🤖 検知モデル設定</span>
              <span class="accordion-icon">▼</span>
            </button>
            <div class="accordion-content">
              <div class="form-group">
                <label>
                  <input type="checkbox" id="yoloEnabled" checked>
                  YOLO検知を有効にする
                </label>
              </div>
            </div>
          </div>

          <!-- スマホ検知設定 -->
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span>📱 スマホ検知設定</span>
              <span class="accordion-icon">▼</span>
            </button>
            <div class="accordion-content">
              <div class="form-group">
                <label for="phoneThreshold">
                  アラートを鳴らすまでの時間 (秒)
                  <span class="description">スマホが検知され続けてからアラートを鳴らすまでの秒数</span>
                </label>
                <div class="slider-container">
                  <input type="range" id="phoneThreshold" min="1" max="600" value="10" step="1">
                  <span id="phoneThresholdValue" class="slider-value">10秒</span>
                </div>
              </div>

              <div class="form-group">
                <label>
                  <input type="checkbox" id="phoneAlertEnabled" checked>
                  スマホ検知アラートを有効にする
                </label>
              </div>

              <div class="form-group">
                <label for="phoneConfidence">
                  検知感度 (信頼度)
                  <span class="description">高いほど確実な検知のみ反応します</span>
                </label>
                <div class="slider-container">
                  <input type="range" id="phoneConfidence" min="0.1" max="0.9" value="0.5" step="0.1">
                  <span id="phoneConfidenceValue" class="slider-value">0.5</span>
                </div>
              </div>
            </div>
          </div>

          <!-- 不在検知設定 -->
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span>👤 不在検知設定</span>
              <span class="accordion-icon">▼</span>
            </button>
            <div class="accordion-content">
              <div class="form-group">
                <label for="absenceThreshold">
                  アラートを鳴らすまでの時間 (秒)
                  <span class="description">人が検知されなくなってからアラートを鳴らすまでの秒数</span>
                </label>
                <div class="slider-container">
                  <input type="range" id="absenceThreshold" min="1" max="600" value="30" step="1">
                  <span id="absenceThresholdValue" class="slider-value">30秒</span>
                </div>
              </div>

              <div class="form-group">
                <label>
                  <input type="checkbox" id="absenceAlertEnabled" checked>
                  不在検知アラートを有効にする
                </label>
              </div>

              <div class="form-group">
                <label for="absenceConfidence">
                  検知感度 (信頼度)
                  <span class="description">高いほど確実な検知のみ反応します</span>
                </label>
                <div class="slider-container">
                  <input type="range" id="absenceConfidence" min="0.1" max="0.9" value="0.5" step="0.1">
                  <span id="absenceConfidenceValue" class="slider-value">0.5</span>
                </div>
              </div>
            </div>
          </div>

          <!-- 検知対象設定 -->
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span>🎯 検知対象設定</span>
              <span class="accordion-icon">▼</span>
            </button>
            <div class="accordion-content">
              <div class="setting-description">
                監視する物体のカテゴリーを選択してください
              </div>
              <div id="detectionClassesContainer" class="class-toggles">
                <!-- JavaScriptで動的に生成 -->
              </div>
            </div>
          </div>

          <!-- 音声設定 -->
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span>🔊 音声設定</span>
              <span class="accordion-icon">▼</span>
            </button>
            <div class="accordion-content">
              <div class="form-group">
                <label for="voicevoxSpeaker">
                  VOICEVOX 話者
                  <span class="description">音声合成に使用する話者を選択</span>
                </label>
                <select id="voicevoxSpeaker" class="form-select">
                  <!-- JavaScriptで動的に生成 -->
                </select>
              </div>
            </div>
          </div>

          <!-- 通知設定 -->
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span>🔔 通知設定</span>
              <span class="accordion-icon">▼</span>
            </button>
            <div class="accordion-content">
              <div class="form-group">
                <label>
                  <input type="checkbox" id="soundEnabled" checked>
                  アラート音を有効にする
                </label>
              </div>

              <div class="form-group">
                <label>
                  <input type="checkbox" id="desktopNotification" checked>
                  デスクトップ通知を有効にする
                </label>
              </div>

              <div class="form-group">
                <label>
                  <input type="checkbox" id="schedulePreNotificationEnabled" checked>
                  スケジュールの事前通知を有効にする
                </label>
              </div>

              <div class="form-group">
                <label for="schedulePreNotificationLeadMinutes">
                  事前通知のタイミング (分)
                  <span class="description">1〜120分前まで設定できます</span>
                </label>
                <div class="slider-container">
                  <input type="range" id="schedulePreNotificationLeadMinutes" min="1" max="120" step="1" value="5">
                  <span id="schedulePreNotificationLeadMinutesValue" class="slider-value">5分前</span>
                </div>
              </div>
            </div>
          </div>

          <!-- 表示設定 -->
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span>🖼️ 表示設定</span>
              <span class="accordion-icon">▼</span>
            </button>
            <div class="accordion-content">
              <div class="form-group">
                <label>
                  <input type="checkbox" id="showDetections" checked>
                  検出フレームを表示
                </label>
              </div>
              <div class="form-group">
                <label>
                  <input type="checkbox" id="previewEnabled" checked>
                  監視プレビューを表示
                </label>
                <p class="description">OFF にするとカメラ映像は非表示のまま検出だけ継続します</p>
              </div>
            </div>
          </div>

          <!-- Slack レポート設定 -->
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span>📊 Slack レポート設定</span>
              <span class="accordion-icon">▼</span>
            </button>
            <div class="accordion-content">
              <div class="form-group">
                <label>
                  <input type="checkbox" id="slackReporterEnabled">
                  Slack 定期レポートを有効にする
                </label>
              </div>

              <div class="form-group">
                <label for="slackWebhookUrl">Slack Webhook URL</label>
                <input type="text" id="slackWebhookUrl" placeholder="https://hooks.slack.com/services/...">
                <span class="description">Incoming Webhook の URL を貼り付けてください</span>
              </div>

              <div class="form-group">
                <label for="slackScheduleTimes">送信時刻 (HH:MM, カンマ区切り)</label>
                <input type="text" id="slackScheduleTimes" placeholder="13:00,18:00">
                <span class="description">例: 09:00,13:00,18:00</span>
              </div>

              <div class="form-group">
                <label for="slackTimezone">タイムゾーン</label>
                <input type="text" id="slackTimezone" placeholder="Asia/Tokyo">
                <span class="description">空欄のままならシステムのタイムゾーンを使用します</span>
              </div>

              <div class="slack-action-group">
                <button type="button" id="slackSaveBtn" class="btn-primary">Slack設定を保存</button>
                <button type="button" id="slackSendNowBtn" class="btn-secondary">今すぐ送信</button>
              </div>

              <div id="slackReporterMessage" class="slack-message"></div>
            </div>
          </div>

          <!-- タイピング監視設定 -->
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span>⌨️ タイピング監視設定</span>
              <span class="accordion-icon">▼</span>
            </button>
            <div class="accordion-content">
              <div class="form-group">
                <label>
                  <input type="checkbox" id="typingMonitorEnabled">
                  タイピング監視を有効にする
                </label>
              </div>

              <div class="form-group typing-settings-actions">
                <button type="button" id="typingMonitorPauseSettingsBtn" class="btn-secondary">休止 / 再開</button>
                <span id="typingMonitorSettingsStatus" class="typing-settings-status">状態取得中...</span>
              </div>

              <div id="typingMonitorSettingsMessage" class="slack-message"></div>
            </div>
          </div>
        </div>

        <div class="button-group">
          <button id="saveSettingsBtn" class="btn-primary">設定を保存</button>
          <button id="resetSettingsBtn" class="btn-secondary">デフォルトに戻す</button>
        </div>

        <div id="saveMessage" class="save-message"></div>
      </div>
    </div>
  </div>

  <!-- ログドロワー -->
  <div class="drawer" id="logsDrawer">
    <div class="drawer-content">
      <div class="drawer-header">
        <h2>📋 検知ログ</h2>
        <button class="close-btn" data-drawer="logsDrawer">×</button>
      </div>

      <div class="drawer-body">
        <div id="logContainer" class="log-container">
          <p class="empty-message">ログはありません</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 検知ダッシュボードダイアログ -->
  <div class="modal" id="dashboardModal">
    <div class="modal-backdrop" data-modal="dashboardModal"></div>
    <div class="modal-content">
      <div class="drawer-header">
        <h2>📊 検知ダッシュボード</h2>
        <div class="header-actions">
          <button id="dashboardRefreshBtn" class="btn-secondary btn-compact">最新を取得</button>
          <button class="close-btn" data-modal="dashboardModal">×</button>
        </div>
      </div>

      <div class="dashboard-body">
        <section class="dashboard-section filters">
          <div class="filter-group">
            <label for="dashboardRange">期間</label>
            <select id="dashboardRange">
              <option value="24h" selected>直近24時間</option>
              <option value="7d">直近7日</option>
              <option value="30d">直近30日</option>
              <option value="custom">カスタム</option>
            </select>
          </div>
          <div class="filter-group" id="dashboardCustomRange" style="display: none;">
            <label>開始</label>
            <input type="datetime-local" id="dashboardStart">
            <label>終了</label>
            <input type="datetime-local" id="dashboardEnd">
          </div>
          <div class="filter-group">
            <label for="dashboardGranularity">集計単位</label>
            <select id="dashboardGranularity">
              <option value="day">日別</option>
              <option value="hour" selected>時間別</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="dashboardTypeFilter">種別</label>
            <select id="dashboardTypeFilter">
              <option value="all" selected>すべて</option>
              <option value="phone">スマホ検知</option>
              <option value="absence">不在検知</option>
              <option value="override">許可操作</option>
              <option value="alerts">アラートのみ</option>
              <option value="typing">タイピング</option>
            </select>
          </div>
        </section>

        <section class="dashboard-section kpi" id="dashboardKpis">
          <!-- JS で動的に生成 -->
        </section>

        <section class="dashboard-section slack-report" id="dashboardSlackSection">
          <div class="section-header">
            <h3>Slack レポート状況</h3>
          </div>
          <div class="slack-report-body">
            <p id="dashboardSlackSummary" class="slack-summary">Slack レポートは未設定です。</p>
            <div class="slack-upcoming" id="dashboardUpcomingSchedules">
              <div class="slack-upcoming-header">
                <span class="label">直近の予定</span>
                <span class="range">24時間以内</span>
              </div>
              <ul id="dashboardUpcomingSchedulesList" class="slack-upcoming-list">
                <li class="empty">スケジュールを読み込み中...</li>
              </ul>
            </div>
            <ul id="dashboardSlackHistory" class="slack-history-list">
              <li class="empty">履歴がありません</li>
            </ul>
          </div>
        </section>

        <section class="dashboard-section typing-activity">
          <div class="section-header">
            <h3>タイピングアクティビティ</h3>
            <div class="section-actions">
              <button id="typingStatsRefreshBtn" class="btn-secondary btn-compact">統計更新</button>
            </div>
          </div>
          <p id="typingMonitorStatus" class="typing-status">タイピング監視は無効です。</p>
          <div class="table-wrapper">
            <table id="dashboardTypingTable">
              <thead>
                <tr>
                  <th>開始</th>
                  <th>終了</th>
                  <th>キー入力数</th>
                  <th>最長連続入力</th>
                </tr>
              </thead>
              <tbody>
                <tr class="empty">
                  <td colspan="4">データを読み込み中...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <section class="dashboard-section system-events">
          <div class="section-header">
            <h3>システムイベント</h3>
            <button id="systemEventsRefreshBtn" class="btn-secondary btn-compact">最新を更新</button>
          </div>
          <div class="table-wrapper">
            <table id="dashboardSystemEventsTable">
              <thead>
                <tr>
                  <th>発生時刻</th>
                  <th>イベント</th>
                  <th>メタ情報</th>
                </tr>
              </thead>
              <tbody>
                <tr class="empty">
                  <td colspan="3">データを読み込み中...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <section class="dashboard-section chart">
          <div class="section-header">
            <h3>検知トレンド</h3>
          </div>
          <div style="position: relative; height: 280px;">
            <canvas id="dashboardTrendChart"></canvas>
          </div>
        </section>

        <section class="dashboard-section app-usage">
          <div class="section-header">
            <h3>前面アプリ滞在時間 (トップ10)</h3>
          </div>
          <div class="table-wrapper">
            <table id="dashboardAppUsageTable">
              <thead>
                <tr>
                  <th>アプリ</th>
                  <th>滞在時間</th>
                  <th>セッション数</th>
                </tr>
              </thead>
              <tbody>
                <tr class="empty">
                  <td colspan="3">データを読み込み中...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <section class="dashboard-section chrome-usage">
          <div class="section-header">
            <h3>Chromeのみの滞在時間 (トップ10)</h3>
          </div>
          <div class="table-wrapper">
            <table id="dashboardChromeUsageTable">
              <thead>
                <tr>
                  <th>ドメイン / タイトル</th>
                  <th>滞在時間</th>
                  <th>セッション数</th>
                </tr>
              </thead>
              <tbody>
                <tr class="empty">
                  <td colspan="3">データを読み込み中...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <section class="dashboard-section recent-logs">
          <div class="section-header">
            <h3>最新ログ</h3>
            <button id="dashboardExportCsvBtn" class="btn-secondary btn-compact">CSVエクスポート</button>
          </div>
          <div class="table-wrapper">
            <table id="dashboardLogTable">
              <thead>
                <tr>
                  <th>時刻</th>
                  <th>種別</th>
                  <th>継続時間</th>
                  <th>詳細</th>
                </tr>
              </thead>
              <tbody>
                <tr class="empty">
                  <td colspan="4">ログを読み込み中...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- チャットドロワー -->
  <div class="drawer" id="chatDrawer">
    <div class="drawer-content chat-drawer">
      <div class="drawer-header">
        <h2>🗣️ 音声チャット</h2>
        <button class="close-btn" data-drawer="chatDrawer">×</button>
      </div>
      <div class="drawer-body chat-body">
        <div class="chat-history" id="chatHistory"></div>
        <div class="chat-actions">
          <div id="chatVoiceControl"></div>
          <div id="chatStreamingText" class="chat-streaming"></div>
          <button id="chatClearHistoryBtn" class="btn-secondary btn-compact">履歴をクリア</button>
        </div>
      </div>
    </div>
  </div>


  <script src="../../node_modules/chart.js/dist/chart.umd.js"></script>
  <script type="module" src="../constants/voicevox-speakers.js"></script>
  <script type="module" src="../constants/yolo-classes.js"></script>
  <script type="module" src="../renderer/schedule.js"></script>
  <script type="module" src="../renderer/settings.js"></script>
  <script type="module" src="../renderer/monitor.js"></script>
  <script type="module" src="../renderer/dashboard.js"></script>
  <script type="module" src="../renderer/chat.js"></script>
  <script type="module" src="../renderer/tasks.js"></script>
  <script type="module" src="../renderer/app.js"></script>
</body>
</html>
